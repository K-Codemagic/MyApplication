workflows:
    native-android:
        name: Native Android
        instance_type: mac_mini

        environment:
            vars:
                # Android Keystore environment variables
                CM_KEYSTORE: Encrypted(Z0FBQUFBQmhFUXFqendRMEJ2MnhwTGJqWGxiei1peTJEb2did0tKRmpKQnVNNnJxZEgxRUR5cTJjWUNaTlM4aFNDRzN0SzRRN19tOUVWM1R0WTJpNUtmTEZQV1gtam5tcVJYZ2lXaXBLSEVWVHBtZk1iZXZHYktzNy0tUmJxcktwT0JqRHZUaXR0ejJ3U3p0SU5DMHdxZ0NqRmt6bjlyRTR5Y2FCQ093UDVpaUk5LTVkajNMaE5PZldlbndGUmJObFg4RHZOaUJPQlFxMWJwMFpCY0tUZGtoTW9vUmpVS2hWMHhLaU9HWXRLMjRFS3ZlOGI2M3hjY3VXUTJDaG5aXzV1eGdKVW9rZzQzUjVtbzFkc2ZVMTFlVXdnaE50Y29DSWNLTVQ1TUdiakhueG4yNkVaRlI2eWJ4TU52SFltNUhOdE9fb1FiUDFoMXFya1MxdHNPRGZQNkE4RlB5WUdmM1hUdHdLNlEtWExHWTJtWFVQdjl5Y1U2WWxZSTlKRWlZNTdicXVVbmNWZWE1VWxFYlVJV3Mzc2c2Ujd4ckN0cS16a1RqLTNMcjRMWjV0WDM5YUZTVkZtaERQTHNBZjRjRl9JMGc4VTM3bTVLRzZsSEJpeDlJUGRZa2hOc1RDUnRGUmYxaDhQd2VFMmF1UDY1X0MzMTl2V29ER3g3ZzN1R2hUUVBlaVc2VE42WXozNlZnVG95ajIyeUJNVEJUTWc0YTVyYVFKUG9CQnVLTW13UlhXbmp4TThOYm9GZUtCX3RYbnd4ZHR1eGdxWFMzWmdJRlVRRVN2WDdlOWhPeXRjOEFhNWhLaGNkZEdqZExTUWtXcjFLZUJTNzRYYURuNUVCRFd5cjJIb3UyLVNqb19vMGZhSWlpX2QwZ1J4bC1TQkgtemEycUZRWWVlc0NrNWQ2dnlhYWNycjdUWDNJLUZqbUtjVmZpRGkzaFhuSHJseEt4Sk5JZVdvZDNwZGhmdUNsMktuaDgwOWZnQWFVU1hmdzlVX0plUG5obTdRcFFXeDljX0V2RkhSNFBTR3RkQlhnN0RuUHgzOTZnaXRNbkhoSDRGeGd1U2x6RFpSdHdhWVZzLVNBbFR3dnFIOG02SE42aXpWV3lINTFESkppWjdUSTZCUmlrMUg5MTk2bkxRZmI0S2dpeUNFamZ0em1NTVVkeXBYa2hYNVhsaUJCNHJIZlZYNmhvQWU3NWYtV2lxd2kzTDhVQ0QwMEwzcnloQWl6LWNqRlJLdlZmMVlLMDdNdmdwdkQ0VWdTVUJQbU5Eamw4S2p0dnByVkdrU3lnM3FVTk9oWGxObllPME5qMFlpYjdrSVlsdHA1UF93UVQxMWU4aVNVOG5zbEFsM2ZydVREeE50MXMwR08yZnE4c2RmaHcwYTJrZ1o4dkEzMGUyZ0NFS2hxR1ZndG5ELTZhdWV6ODhaTnZiTlB0T3ZTSFI0VWVrZ080M2QyTTdlU3ZseDhraUVSTWplQ0NrZWdWS3JOUmYzVjF6a2c5dkltQkllTlJxUWZpTUxYa2ZWZTVuVXpRTERncFQxQTdjRDd0X20ydlRxZjVKM0xUSDdEaFFYZVF1enlXdFloaVpRa1NNVXI0ZEJYNjlQRmFqZE1WNHU5clp0NUxqUzhocHRsLWNLNTJPRTlXS2RBczFRSTdQZUNHNTdTanBQdm5uNE52QjAzanlNcTNCbElWTzViQ0hhS1N5cGhucTBMSHhDS2FsTmJ2bGgxQWNrTlB1OTNsNXdkWDdnN3NKV2pwR0FFa000TzVfOUJWck5fMkFpY0h1blhwa3cyRUJvaTZBMVNzeWhyUGxuQXJGTnZQT04zWjNlZjh6c09nSjRPU1dvZXFyZzFrekVpLTA5OVBBa2ZNc25QVm1MSFBCUUlUM01OdWF3dDgzanRVZHN1SEFYMnJpcXZ1cWZXTzd6YmFzZ2laRFRHc3ZaS2NULUgxeVcyN0xabG1sUWVQQUF5dTRkUGp6V05LV3FLaExycGpMRTBNc01qM3hFbHpUbEhnV2l0SElnd1hkMHV0bzduUGZUNTNiTWRXbzYyUDVtVmtINHkxVmxnM3luQjJvMTV2dmJfbUN3UG9ZRFNaVWNuRXBaSUFiNHc1NUFRTUl0ZE9sUjRjS24zY05HeF9rYzlpX3pyb280NldwZy1mQ0h2RmJELVBic0hBdHJYazlMRVVXeUZzQTM2QW4wdVNwWnI1MzFBckF0OGR1OGNCZWdwbnY3am9KM0ptYk01WDVhMlROcFEzbmUzSnVETjNKTk9ZTm4xUGJLRVNTX29DVWtGMTFqMWJodjNIdXJtTGo0Y0p0LU9pLXlUdjFQOGN6UzcyUk5fLXNIRVE2dWJxWHZETmVUbktSOW9KTmUtR0pkWDhDUEphbXdrM1d4YV8yRmhJSkIxR2NPakYtMVZqQlEyMDhCTTdqekpXS2JvLVdGelRxYkc4U28yUVptWlozU3VfaXd1UHJDTm1CeEZramJBYzBYdTA2cHhPVDhxbVdKNnJzaE9Wc1hGTnpvZDRSWGpkLUQzdk81U3VTaUR3RHJWMDRobzFwNTFiT05QUzNoSU1vUm55QjJGWlctajcxX2dZWGh1N29LcXNlb3dRRGNZbUFxRS16T0Z4YW91eWVDNWZEOTZtSXV1UVN1RjVabnFldHJSWXAyNDd1dnlPT3FZaW5kN0lPak5MYm9wXzhGR0tvN2xyM2lLOW9SU2hXWENZZjdoZDI4SHhIVXMxSVdEMWJ1WDdjLUN3UGRZZm5wUk5rdlRWdzl4UUZ0LXNVYWFjU240TmNYTzA3REZHM1hyYmpfWTFLdWZhVGJEa1loNkxER1UwZlNrNi10dUZETDlEQTBwQl9sMTd3QjlFVTZNSldfT19JZnBpTE9LX2ZCUU5temRYeU1HT2RMZ0RnLWtWWEhSSmRVc1JhajhrelA0THJYYjRHN1E1bmNhNFZwSmxRaUpsbmpJSzUzM2lyNjhjVFFFV1R6TnNhZVI1WFVPaGs1enVzRjhnYnVfS1pFNHFVcEU4Sk9XM0NoNno2X2s4Ym5sZGhDNW53eThnZElKTDdERFItQmZ4Y1FDR2JFNi0zXzYwUm1DRnR4SnBTMkRaTmg2cFhvX0lfSEdFUFBheHE5WGQ0WktWdlI2dlZfVWNxWmpCdUhtZW1VVEdBSGxPa28wZktpeXZtczBhWloyMFlJTnVObHBjSlpuajVBbENFcG9uUVBTN05PWXd5M3Y3aVJiQUxsS25qVHhUYmdEbVAwRXFzRU9lSk9vdm81RVpwREl6MGUzVERmRm4yYUczUmdRejFmN1l0bHhfVGczakE5bWhWUGpjOXNGbWtjWGVwTnJJNnRFUGlpbXhPSF93cHlaX2psbTg3aGxadmVZM040N0RzeVRNUVdMMTRpMkVJUmZtc3hhMFlZbW9QU0NtdUpMSmVycjFQVVBDcTFBX3FmZmpBQ1c5OE00ZG9JeHZLS0Fxb0F1UW9LRERSVU1hUnUtR0F6NThnckY0eG5hd2tCS2ZNd2UtVEp0V0Y0bUZZblZUYmEyMzlKel80WjFlZ3liRFE4NFZzLWJDRE9xZFE5T0FvZGJ4V01tdVJESEt6NER6RVpXc0ZCMkxGMzRmdHFXOVh4NzhMT2JEeEFqQ3gwSzF6b1VjN0tSWVYxcE9JcDJPZ1hQanJfRXE1WmhQX3d5ekg0NFYxVGlsTmZub3d3dWZmUWoteGlYNkFxUm4wZTc3U2h2V3FvODFFVWViWndVTENqMlhnOHByRzhmM0lUWkdSYUxwNkpQQzBjQmV0MC1XVmpqWEpWRUkyaktuTmxtLU1tWFBtQ0k0UV9zdHlfT1Y2MC1ONklockJJank5dHgyRTRwenVYXzBpZ2RGUFZKM0pMdk1CX2ZzSFRoczc2YzFzTmVTXy1qMzNQR2tmMDBxUWQ0Yl8zbEJZX2ZXMVRnU2hOYVBzcGdTcGk4c3pJeE1LWXA1V2VnNmUtYXVrcEhINS1EdWJ6R2hLSXdXSURBZmNIZGQ2Nk1DdkxNdUVmMmNicFc4ZmgyQmRHS0NoeTlHajZFNGg5LXZ5ZjdCUGg5dXp3UUswaU9mcFNJeU9VRWFSSWRLTU41bHZYNnVBb3dTRFZLYVNLTVdKNVJCNGhRTXZkT0lZQ0xuZHJrV0FhdTJxTlhxS2ZtNXdNbVBZRnMyeFpkdVVUeDhieUpfSVcwdFpuZkVlSjZWN0hVdmt1M2U2V2l5MzBBX0t1ajVnZ1lpQ3d0eEcwaHZqSEYzRUtyenpSd0tfZTVuaXQzeWdQTVpNcV9uOUVkRDZJbVZzWV9DSDF2WkN6VnM3T1pKcG5TWFVURklrQXgzTldIdF9DUnk4WjdELWFlZDNmcDhMbVhKUV9mNFg5LUF2SXBtUzlMT0R0ZmdpZ0dlb1IwemtScjJLdlo0RGp1Tko0OFh6TzZsNkR2VnQ3RU5jTkZRbF9lTlNhbllFUlBhUlh3X0U5b1c0TjlBdXRzbHZ6d21oSGwyc2VicnFCdG9senZCMDFSRGlqTWx0RElnZWxaajc4ZmNXVU9FZnAwbjNMNFFnbGVPTUxvWkxnQVVOM0dBR210eE1JN0tCbHRZV1BBMVRJN19HNjVJMXFFUmVKWlpTVUc1dERfT0IxZmJxMTZ0eEwzNlBQbHNsZ2wwWkpvRDFBekYzWlQzTWhYTlBXQmsxNVB1UGFUbjcyMkxkellEellHSTAxYmdwclZlTTFEaXpmZDBoeXpuUUNTVUIwWTBVNE5jcUJ5a3cwMXMtM3V2THloSTdHQi14eF9EYkd3OHpYMkg5czY0ZFRsXzBDd21mRTF2RnA0emJUZF9INVFoREFkcmlGbEFNeXhtU0lmV19oMkpVZkNoTXRyUTFOdVBoR0pTM2pXODdLMHR0SV9TVWtfMlNLTzc2LTNqd0w0Qmx0ek1sbEhIQS1RRkpMYXo3dnhkSFk2a3dOWjU5MTRfdWFabklKS2tKRnFmRlZXRkdIRkVwRGs2eFUzZUk4RVV2ZmswZkNseE5GM3ZWS2RGV2pOenJZa0I0T0ltcXNhV2I5c1o5eGJhWjZ2RDlwZ191N1M4dzZEMm85UExVRkN6S19EcEVKelhnc2ltTTlQaWYxLTBpWVowYU8yTDQxX29XZEpKUkxVelZYdVVGU0ZWNHBEd2VJLXpSYkxIdEt4Zm5DVVJuc1htTlJpQXE3Q1U2d2ZrOUxaMDYxMXdLQXdFNUJ1M2liYjF2blotSHJSc2thUzJhdnNjd0x2NjBZTklZOTJidHU4OE12bVc0RzhtWU9YM2tUZGJDaWdwYzIxUW5DQlo=)
                CM_KEYSTORE_PASSWORD: Encrypted(Z0FBQUFBQmhFUXV4Tmd0b0paQWRPRG1GdjdTTWFWRzVYMDB5X0lsN0Q1RDdQNE9vOUZ2M29fYmlWN21jenRVbGVmX0sxWTRGNnF1Wk1IeUpOc1BHUjhuX1pZczNzTW1UUkE9PQ==)
                CM_KEY_ALIAS_PASSWORD: Encrypted(Z0FBQUFBQmhFUXV4Tmd0b0paQWRPRG1GdjdTTWFWRzVYMDB5X0lsN0Q1RDdQNE9vOUZ2M29fYmlWN21jenRVbGVmX0sxWTRGNnF1Wk1IeUpOc1BHUjhuX1pZczNzTW1UUkE9PQ==)
                CM_KEY_ALIAS_USERNAME: Encrypted(Z0FBQUFBQmhFUXZaQmY3bXZUU1VuYXpSVk1PMVZXNmV5OVhHazdoMXNEYVRPazExczhmOWYwbUJfaC0yTXl5RzB6UndpYzdpUFdVQTNSWmJXOVNySEcxZzhYc1RfSzdjZlE9PQ==)
            node: latest
            xcode: 12.2
        triggering:
            events:
                - push
                - tag
                - pull_request
            branch_patterns:
                - pattern: develop
                  include: true
                  source: true
        scripts:
            - name: Set Android SDK location
              script:
                echo "sdk.dir=$ANDROID_SDK_ROOT" > "$FCI_BUILD_DIR/local.properties"
            - name: Set up keystore
              script: |
                    echo $CM_KEYSTORE | base64 --decode > /tmp/keystore.jks
                    cat >> "$FCI_BUILD_DIR/key.properties" <<EOF
                    storePassword=$CM_KEYSTORE_PASSWORD
                    keyPassword=$CM_KEY_ALIAS_PASSWORD
                    keyAlias=$CM_KEY_ALIAS_USERNAME
                    storeFile=/tmp/keystore.jks
                    EOF   
       - name: Build Android app
        script: ./gradlew assembleRelease
        artifacts:
            - app/build/outputs/**/*.apk
        publishing:
            email:
                recipients:
                    - kalgi@nevercode.io
                notify:
                  success: true
                  failure: false   
